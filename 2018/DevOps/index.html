<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>DevOps 之路 | Phylee的小站</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a><a class="sidebar-nav-item" href="/about">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/DevOps/">DevOps</a></div><div class="post-time">2018-06-18</div></div></div><div class="container post-header"><h1>DevOps 之路</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Devops-实施的前提条件"><span class="toc-number">1.</span> <span class="toc-text">Devops 实施的前提条件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#流水线"><span class="toc-number">2.</span> <span class="toc-text">流水线</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分支模式的选择"><span class="toc-number">3.</span> <span class="toc-text">分支模式的选择</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#主干分支开发"><span class="toc-number">3.1.</span> <span class="toc-text">主干分支开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#特性分支开发"><span class="toc-number">3.2.</span> <span class="toc-text">特性分支开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#主干分支开发-特性开关"><span class="toc-number">3.3.</span> <span class="toc-text">主干分支开发 + 特性开关</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#环境"><span class="toc-number">4.</span> <span class="toc-text">环境</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#线下环境"><span class="toc-number">4.1.</span> <span class="toc-text">线下环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#线上环境"><span class="toc-number">4.2.</span> <span class="toc-text">线上环境</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#持续交付可能面临的挑战"><span class="toc-number">5.</span> <span class="toc-text">持续交付可能面临的挑战</span></a></li></ol></details></div><div class="container post-content"><h2 id="Devops-实施的前提条件"><a href="#Devops-实施的前提条件" class="headerlink" title="Devops 实施的前提条件"></a>Devops 实施的前提条件</h2><p>软件架构解耦， 可独立部署，独立升级。</p>
<h2 id="流水线"><a href="#流水线" class="headerlink" title="流水线"></a>流水线</h2><p> 流水线是指软件从版本控制仓库到用户手中可使用这一过程的自动化表现形式。对软件的每次变更都会经历一系列的流程才能发布，这一流程包括单元测试、构建、打包、部署，集成测试， 性能测试，安全扫描，发布等。流水线是对这一流程的建模。</p>
<ul>
<li><p>流水线的核心理念</p>
<p>基于价值的交付。基于数据的准确度量，帮助开发或者管理者评估产品价值和优化团队效率。</p>
</li>
</ul>
<h2 id="分支模式的选择"><a href="#分支模式的选择" class="headerlink" title="分支模式的选择"></a>分支模式的选择</h2><p>根据开发团队的规模和实际情况可以选择适合的模式。没有绝对的好坏，各有利弊。</p>
<h3 id="主干分支开发"><a href="#主干分支开发" class="headerlink" title="主干分支开发"></a>主干分支开发</h3><p>优点：大家都往一个分支合并，更容易持续集成，因为只要不停集成测试这一个分支就行，维护起来更简单。分支合并冲突也会更容易提前暴露，这样更容易解决。<br>缺点：所有特性开发测试完成后才能统一发布，无法独立发布。有可能一个特性开发测试的快，另一个特性开发比较慢，但是也要等着全部特性开发并测试完成后才能发布。时间长了会降低开发比较高效的开发人员的积极性。</p>
<h3 id="特性分支开发"><a href="#特性分支开发" class="headerlink" title="特性分支开发"></a>特性分支开发</h3><p>优点：每个特性都可以独立开发，测试，发布。更灵活。<br>缺点：因为每个特性分支都是独立开发的，所以最后合并冲突的概率会大大增加。所以要经常将主干分支代码合并过来，减少最后合并冲突的概率。但是如果特性分支比较多，不同特性合并到主干前是独立的，最后合并冲突也是不可避免的。</p>
<h3 id="主干分支开发-特性开关"><a href="#主干分支开发-特性开关" class="headerlink" title="主干分支开发 + 特性开关"></a>主干分支开发 + 特性开关</h3><p>优点：具有主干分支开发的优点，同时开发慢的特性也不会拖慢开发快的特性的发布。只要特性开关不打开，没有完成的特性代码发布到线上也没有问题。<br>缺点：特性开关是会侵入到现有代码的，增加代码的复杂度。随着特性开关的越来越多会增加后期代码维护的难度。</p>
<p>根据开发团队规模：小规模团队一般采用特性分支的模式，，非常大的团队一般采用主干开发模式或者主干开发加上特性开关。因为现在微服务的流行，一般服务拆分后每个服务都是较小的团队维护，所以现在采用特性分支开发的比较多。</p>
<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><h3 id="线下环境"><a href="#线下环境" class="headerlink" title="线下环境"></a>线下环境</h3><ul>
<li>开发测试环境：这个环境主要是开发使用，能够快速验证自己开发完的代码。不需要和线上环境相同，如果有依赖，可以直接使用集成测试环境的服务。</li>
<li>集成测试环境： 这个环境的应用的各类基础服务和线上环境保持一致，只是比线上环境规模小很多。因为开发和测试都在使用，同时不能影响测试的效率，所以这个环境要求稳定。如果变更是有损的，需要严格的审核，不能随意发布新的变更。如果变更是无损的，变更审核会简单点，可以较频繁的进行变更。所以无损变更可以更加充分的利用该环境，提高环境的使用效率。</li>
</ul>
<h3 id="线上环境"><a href="#线上环境" class="headerlink" title="线上环境"></a>线上环境</h3><ul>
<li>预发环境 ：和正式生产环境的状态基础服务共用，如 DB，KV，文件存储以及搜索类的数据服务。网络上独立网段划分，不承担线上真是流量。<blockquote>
<p>预发环境正式使用后的另一用途：就是生产环境出现问题，但是线下环境复现不了时，就可以在预发环境上复现。</p>
</blockquote>
</li>
<li>灰度环境：金丝雀发布就是基于该环境发布。简单理解就是从生产环境的集群中，再建立一个独立集群，就是再建立一个分组，独立出一个集群，大概只有1——2台服务器数量，主要针对小规模真是业务流量。如何保证流量小规模，就需要负载均衡策略上做工作, 主要两种方式：1.调用RPC，在服务化框架的复杂均衡策略中，将其权重或者流量配比降低。2.调用HTTP，在四层VIP或者七层权重上，将其权重降低。<blockquote>
<p>除了承担流量不同，其他和生产环境的应用没有差别，主要针对核心应用。</p>
</blockquote>
</li>
<li>生产环境</li>
</ul>
<h2 id="持续交付可能面临的挑战"><a href="#持续交付可能面临的挑战" class="headerlink" title="持续交付可能面临的挑战"></a>持续交付可能面临的挑战</h2><ul>
<li>缺少自动化测试覆盖的持续交付会成为负担。当我们单元测试、API测试做的不好的时候，通过流程强加的持续交付基本上是自欺欺人，要么就是不稳定，要么就是没效果。</li>
<li>测试团队转型，开发全栈导致的质量下降。有这么多需求，没时间写测试，或者保姆式服务享受惯了，开发人员自己没这个意识。</li>
</ul>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
e=o.createElement(i);r=o.getElementsByTagName(i)[0];
e.src='//www.google-analytics.com/analytics.js';
r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
ga('create','UA-153622478-1');ga('send','pageview');</script></body></html>