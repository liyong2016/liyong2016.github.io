---
title: 持续交付：发布可靠软件的系统方法—-读书笔记
date: 2018-02-04 12:45:46
tags:
- CICD
---

[豆瓣链接](https://book.douban.com/subject/6862062/)

本文主要是对阅读书籍我认为重要的内容进行概要记录。

# 基础篇

## 第1章 软件交付的问题

1.6 软件交付原则

* 为软件发布创建一个可重复且可靠的过程

 如何做到：（1）几乎将所有事情自动化。（2）将构建、部署、测试和发布软件所需的东西全部纳入到版本控制管理之中。
* 将几乎所有事情自动化

自动化是部署流水线的前提。

* 把所有的东西都纳入版本控制

包括文档，测试脚本，配置脚本，部署脚本，升级和回退脚本等等。

* 提前并频繁地做让你感到痛苦的事

* 内建质量
 将软件问题提前暴露，一旦发现流水线有失败，就要马上着手修复。

* "DONE" 意味着 “已发布”

一个特性只有交到用户手中才能算 ”DONE”。
> phylee注： 这个原则意味着，1.从开发业务代码到上线生产环境必须要快。否则一个月甚至更长时间才能上线生产环境，开发人员早就忘了。2. 业务开发人员一定会关注代码发布过程，这样也可以不断完善改进流水线，催熟流水线。

* 交付过程是每个成员的责任
* 持续改进

## 第2章 配置管理

2.1 本章将讨论三个问题：

* 为管理应用程序的构建，部署，测试和发布过程做好准备。从两个方面解决这个问题：对所有内容进行版本控制；管理依赖关系。
* 管理应用软件的配置信息。
* 整个环境的配置管理，包括应用程序的依赖软件，硬件和基础设施。

2.2 使用版本控制

* 对所有内容进行版本控制，不仅仅是源代码，包括测试代码，数据库脚本、构建和部署脚本等所有和软件发布的文件都要纳入版本控制中。
* 频繁提交代码到主干，因为长时间不提交代码会让合并工作变得过于复杂。

2.4 软件配置管理

* 应该以对待代码的方式来对待系统的配置，使其受到正确的管理和测试。
* 配置与灵活性。灵活性是有代价的。
> phylee注： 修改配置并不比修改代码风险低，因为配置修改更难被测试。除非有很好的回滚机制，因为回滚配置可以很快。回滚机制的前提是有版本控制。

2.5 环境管理

环境管理的关键在于能通过一个全自动过程来创建环境。

## 第3章 持续集成

3.2 实现持续集成 需要满足3个条件：

* 版本控制
* 自动化构建
* 团队共识
 团队共识很重要。持续集成不是一种工具，而是一种实践。需要开发团队的给予一定投入并遵守一些准则。

# 部署流水线

## 第5章  部署流水线解析

5.3  部署流水线解析

* 只生成一次二进制包
 保证所有环境验证发布包是同一个。
* 对不同环境采用同一部署方式
 代码和应用配置文件分离，应用配置文件和环境相关。生产环境和开发测试环境应该由同一个团队管理。
* 对部署进行冒烟测试
* 向生产环境的副本中部署
 开发测试环境尽可能和生产环境相同。
* 每次变更都要立即在流水线中传递
* 只要有环节失败，就停止整个流水线
 一旦出现失败，变更团队应停下手头工作，立即着手修复。

5.7.2 变更的撤销
软件版本的快速迭代，不可避免会有一些缺陷，快速回滚是保障快速发布的的重要能力。

5.8 实现一个部署流水线
无论是从零创建新项目，还是想为已有的系统创建一个自动化的流水线，通常都应该使用**增量方法**来实现部署流水线。
> phylee注：理解“增量”很重要，流水线的建设从来不是一步到位的，不同公司交付模式不同，流水线也会不太一样，需要使用者和建设者的协作并根据实际交付流程不断完善它。

建立完整流水线一般步骤:

1 . 对价值流进行建模并创建简单的可工作框架
> 能画出从代码提交到发布的整个过程的价值流程图。

2 . 将构建和部署流程自动化

3 . 将单元测试和代码分析自动化

4 . 将验收测试自动化

5 . 将发布自动化

5.9 度量

反馈是所有软件交付流程的核心。改善反馈的最佳方法是缩短反馈周期，并让结果可视化。

重要的问题是：度量是什么？选择什么样的度量项对团队行为有很大的影响。

对于软件交付过程来说，最重要的全局度量指标就是周期时间，它指的是从决定要做某个特性开始，直到把这个特性交付给用户的这段时间。“你所在的组织中，如果仅仅修改过一行代码，需要多长时间才能把它部h署到生产环境中？你们是否以一种可重复且可靠的方式做这类事情？”

## 第6章 构建于部署的脚本化

6.3 构建部署脚本化的原则与实践

* 为部署流水线的每个阶段创建脚本
* 使用同样的脚本向所有环境部署
* 确保部署流程是幂等的

6.5 部署脚本化

环境管理的核心原则之一就是：对测试生产环境的修改只能由自动化过程执行。也就是说，我们不应该手工远程登陆到这些环境上执行部署工作，而应该将其完全脚本化。

# 交付生态圈