<html>
<head>
	
	<title>文件传输工具(Linux)</title>
	<meta name="keywords" content="My Blog" />

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
	   <link href="/css/main.css?v=3" rel="stylesheet" type="text/css" />
    
        <script src="/js/util.js"></script>
        <script>
            if(isMobile()) {
                loadjscssfile('../css/mobile.css', 'css');
            } else {
                loadjscssfile('../css/desktop.css', 'css');
            }
        </script> 
    

    <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed">

    
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=3"/>
    

</head>

<body>


<h2 class="title">文件传输工具(Linux)</h2>
<!---
<div style="text-align:center;margin-top: -10px;">
<div class="article-category">
发表于2017年7月7日




 </div>
--->
</div>

<h2 id="sshpass"><a href="#sshpass" class="headerlink" title="sshpass"></a>sshpass</h2><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight shell"><table><tr><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> yum install sshpass</span></div></pre></td></tr></table></figure>
<h4 id="使用方法（3种）"><a href="#使用方法（3种）" class="headerlink" title="使用方法（3种）"></a>使用方法（3种）</h4><p>1 . 直接用密码<br><figure class="highlight shell"><table><tr><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> sshpass -p <span class="string">'host_pass'</span> ssh user@host_ip <span class="string">'df -h'</span></span></div><div class="line"><span class="meta">$</span><span class="bash"> sshpass -p <span class="string">'host_pass'</span> scp -r root@host_ip:/home/<span class="built_in">test</span>/ ./tmp/</span></div></pre></td></tr></table></figure></p>
<p>首次连接需要加参数-o StrictHostKeyChecking=no, 否则return code是6 ：<br><figure class="highlight shell"><table><tr><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> sshpass -p <span class="string">'host_pass'</span> ssh  -o StrictHostKeyChecking=no  user@host_ip <span class="string">'df -h'</span></span></div></pre></td></tr></table></figure></p>
<p>2 . 使用环境变量保存密码<br><figure class="highlight shell"><table><tr><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> SSHPASS=<span class="string">'host_pass'</span></span></div><div class="line"><span class="meta">$</span><span class="bash"> sshpass -e ssh user@host_ip <span class="string">'df -h'</span></span></div></pre></td></tr></table></figure></p>
<p>3 . 使用文件保存密码<br><figure class="highlight shell"><table><tr><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> sshpass -f password_filename ssh user@host_ip <span class="string">'df -h'</span></span></div></pre></td></tr></table></figure></p>
<h2 id="rysnc"><a href="#rysnc" class="headerlink" title="rysnc"></a>rysnc</h2><p>快速，增量的文件传输工具。支持本地和远程文件传输。</p>
<h4 id="rysnc为何速度快？"><a href="#rysnc为何速度快？" class="headerlink" title="rysnc为何速度快？"></a>rysnc为何速度快？</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">无论是本地或远程文件传输， rsync 首先创建每个源文件块校验的索引。此索引用于查找可能存在于目标中的任何相同数据块。一旦这种块存在，块就被就地使用，而不是从源复制。这大大加快了存在小差异的大文件的同步</div></pre></td></tr></table></figure>
<h2 id="scp-（可搭配expect）"><a href="#scp-（可搭配expect）" class="headerlink" title="scp （可搭配expect）"></a>scp （可搭配expect）</h2><h4 id="expect是一个用来处理交互的命令。"><a href="#expect是一个用来处理交互的命令。" class="headerlink" title="expect是一个用来处理交互的命令。"></a>expect是一个用来处理交互的命令。</h4><p>expect中四个常用命令是send,expect,spawn,interact。<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">send：用于向进程发送字符串</div><div class="line">expect：从进程接收字符串</div><div class="line">spawn：启动新的进程</div><div class="line">interact：允许用户交互</div></pre></td></tr></table></figure></p>
<p>Example: 如下脚本autoscp.sh<br><figure class="highlight shell"><table><tr><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash">!/usr/bin/expect</span></div><div class="line">set user [lindex $argv 0]</div><div class="line">set ip [lindex $argv 1]</div><div class="line">set passwd [lindex $argv 2]</div><div class="line">set srcfile [lindex $argv 3]</div><div class="line">set dstdir [lindex $argv 4]</div><div class="line"></div><div class="line">set timeout 20</div><div class="line">spawn scp $srcfile $user@$ip:$dstdir</div><div class="line">expect &#123;</div><div class="line">"yes/no)?" &#123; send "yes\r";puts "yes" &#125;</div><div class="line">"assword:" &#123; send "$passwd\r" &#125;</div><div class="line">timeout &#123; puts "$IP time out" ;exit 1 &#125;</div><div class="line">&#125;</div><div class="line">expect eof</div></pre></td></tr></table></figure></p>
<p>注意点：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">1 . /usr/bin/expect就是 which expect 的路径</div><div class="line">2 . 脚本需要执行权限。 chmod +x autoscp.sh</div><div class="line">3 . 执行脚本是./autoscp.sh, 不是 sh autoscp.sh。否则会报一些命令not found。因为该脚本用的并不是bash,脚本第一行已经写明。</div><div class="line">4 . expect中执行命令是有一个timeout的设定的，默认超时时间为10s。</div><div class="line">若一条命令未timeout限定时间内执行完，就会中断该条命令的下一条命令。</div><div class="line">在expect脚本中设定timeout，可覆盖原本的timeout.</div></pre></td></tr></table></figure></p>


<!--<a href="http://yoursite.com/2017/07/07/file-transfer/#disqus_thread" class="article-comment-link">Comments</a>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'liyong-science'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
-->
<div style="display:none">
<script src="http://s4.cnzz.com/stat.php?id=undefined&web_id=undefined" language="JavaScript"></script>script>
</div>






</body>
</html>